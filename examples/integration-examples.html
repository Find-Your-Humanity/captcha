<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Captcha Widget - 통합 예제</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        .example-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            background: #f9f9f9;
        }
        .example-card h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .captcha-container {
            margin: 20px 0;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background: white;
        }
        .controls {
            margin: 15px 0;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 5px;
        }
        .btn:hover {
            background: #5a6fd8;
        }
        .btn.secondary {
            background: #6c757d;
        }
        .btn.success {
            background: #28a745;
        }
        .btn.danger {
            background: #dc3545;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 15px 0;
        }
        .framework-examples {
            margin-top: 40px;
        }
        .framework-tab {
            display: inline-block;
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .framework-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .framework-content {
            display: none;
            border: 1px solid #dee2e6;
            padding: 20px;
            border-radius: 0 5px 5px 5px;
        }
        .framework-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔒 Real Captcha Widget</h1>
        <p>CDN 기반 캡차 위젯 통합 예제 및 데모</p>
        <p><strong>CDN URL:</strong> <code>https://cdn.realcaptcha.com/latest/realcaptcha-widget.min.js</code></p>
    </div>

    <div class="example-grid">
        <!-- 기본 예제 -->
        <div class="example-card">
            <h3>🚀 기본 사용법</h3>
            <p>가장 스립기 쉫운 기본 캐트차 구현</p>
            <div id="captcha-basic" class="captcha-container"></div>
            <div class="controls">
                <button class="btn" onclick="initBasicCaptcha()">초기화</button>
                <button class="btn secondary" onclick="resetBasicCaptcha()">리셋</button>
            </div>
            <div id="result-basic" class="result" style="display: none;"></div>
        </div>

        <!-- 커스텀 온션 -->
        <div class="example-card">
            <h3>⚙️ 커스텀 옵션</h3>
            <p>다크 테마와 커팩트 사이즈</p>
            <div id="captcha-custom" class="captcha-container"></div>
            <div class="controls">
                <button class="btn" onclick="initCustomCaptcha()">초기화</button>
                <button class="btn secondary" onclick="resetCustomCaptcha()">리셋</button>
            </div>
            <div id="result-custom" class="result" style="display: none;"></div>
        </div>

        <!-- 다중 인스턴스 -->
        <div class="example-card">
            <h3>🔄 다중 인스턴스</h3>
            <p>한 페이지에 여러 캡차 사용</p>
            <div id="captcha-multi1" class="captcha-container"></div>
            <div id="captcha-multi2" class="captcha-container"></div>
            <div class="controls">
                <button class="btn" onclick="initMultiCaptcha()">초기화</button>
                <button class="btn secondary" onclick="resetMultiCaptcha()">리셋</button>
            </div>
            <div id="result-multi" class="result" style="display: none;"></div>
        </div>

        <!-- 동적 로딩 -->
        <div class="example-card">
            <h3>⚡ 동적 로딩</h3>
            <p>JavaScript로 캐트차 동적 생성</p>
            <div id="captcha-dynamic" class="captcha-container">
                <p>아직 캐트차가 로드되지 않았습니다.</p>
            </div>
            <div class="controls">
                <button class="btn" onclick="loadDynamicCaptcha()">캐트차 로드</button>
                <button class="btn danger" onclick="unloadDynamicCaptcha()">제거</button>
            </div>
            <div id="result-dynamic" class="result" style="display: none;"></div>
        </div>

        <!-- 폼 통합 -->
        <div class="example-card">
            <h3>📝 폼 통합</h3>
            <p>실제 로그인 폼과 캐트차 연동</p>
            <form id="login-form" onsubmit="return handleLogin(event)">
                <input type="email" placeholder="이메일" required style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
                <input type="password" placeholder="비밀번호" required style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
                <div id="captcha-form" class="captcha-container"></div>
                <button type="submit" class="btn success" style="width: 100%;">로그인</button>
            </form>
            <div id="result-form" class="result" style="display: none;"></div>
        </div>

        <!-- 성능 모니터링 -->
        <div class="example-card">
            <h3>📊 성능 모니터링</h3>
            <p>CDN 로드 시간 및 성능 측정</p>
            <div class="controls">
                <button class="btn" onclick="startPerformanceTest()">성능 테스트 시작</button>
                <button class="btn secondary" onclick="stopPerformanceTest()">중지</button>
            </div>
            <div id="performance-results">
                <p><strong>로드 시간:</strong> <span id="load-time">-</span>ms</p>
                <p><strong>캐시 상태:</strong> <span id="cache-status">-</span></p>
                <p><strong>파일 크기:</strong> <span id="file-size">-</span></p>
            </div>
        </div>
    </div>

    <!-- 프레임워크 통합 예제 -->
    <div class="framework-examples">
        <h2>🌐 프레임워크 통합 예제</h2>
        
        <div class="framework-tabs">
            <div class="framework-tab active" onclick="showFramework('vanilla')">바닐라 JS</div>
            <div class="framework-tab" onclick="showFramework('react')">리액트</div>
            <div class="framework-tab" onclick="showFramework('vue')">뷐</div>
            <div class="framework-tab" onclick="showFramework('angular')">앵귈러</div>
            <div class="framework-tab" onclick="showFramework('wordpress')">워드프레스</div>
        </div>

        <div id="vanilla" class="framework-content active">
            <h4>🌿 바닐라 JavaScript</h4>
            <div class="code-block">
&lt;!-- HTML --&gt;
&lt;script src="https://unpkg.com/react@18/umd/react.production.min.js"&gt;&lt;/script&gt;
&lt;script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"&gt;&lt;/script&gt;
&lt;script src="https://cdn.realcaptcha.com/latest/realcaptcha-widget.min.js"&gt;&lt;/script&gt;

&lt;div id="my-captcha"&gt;&lt;/div&gt;

&lt;script&gt;
// 기본 사용
renderRealCaptcha('my-captcha', {
  theme: 'light',
  size: 'normal'
}, function(result) {
  if (result.success) {
    console.log('캐트차 성공:', result.token);
    // 서버로 토큰 전송
  }
});
&lt;/script&gt;
            </div>
        </div>

        <div id="react" class="framework-content">
            <h4>⚛️ React 컴포넌트</h4>
            <div class="code-block">
// RealCaptcha.jsx
import { useEffect, useRef } from 'react';

function RealCaptcha({ onComplete, theme = 'light', size = 'normal' }) {
  const captchaRef = useRef(null);
  const instanceRef = useRef(null);

  useEffect(() => {
    if (typeof window !== 'undefined' && window.renderRealCaptcha) {
      instanceRef.current = window.renderRealCaptcha(
        captchaRef.current,
        { theme, size },
        onComplete
      );
    }
    
    return () => {
      if (instanceRef.current) {
        instanceRef.current.destroy();
      }
    };
  }, [onComplete, theme, size]);

  return &lt;div ref={captchaRef} /&gt;;
}

// 사용예시
function App() {
  const handleCaptcha = (result) =&gt; {
    console.log('캐트차 결과:', result);
  };

  return (
    &lt;RealCaptcha 
      onComplete={handleCaptcha}
      theme="light"
      size="normal"
    /&gt;
  );
}
            </div>
        </div>

        <div id="vue" class="framework-content">
            <h4>👧 Vue.js 컴포넌트</h4>
            <div class="code-block">
// RealCaptcha.vue
&lt;template&gt;
  &lt;div ref="captchaContainer"&gt;&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: 'RealCaptcha',
  props: {
    theme: { type: String, default: 'light' },
    size: { type: String, default: 'normal' }
  },
  mounted() {
    this.initCaptcha();
  },
  beforeUnmount() {
    if (this.captchaInstance) {
      this.captchaInstance.destroy();
    }
  },
  methods: {
    initCaptcha() {
      if (typeof window !== 'undefined' && window.renderRealCaptcha) {
        this.captchaInstance = window.renderRealCaptcha(
          this.$refs.captchaContainer,
          {
            theme: this.theme,
            size: this.size
          },
          this.handleComplete
        );
      }
    },
    handleComplete(result) {
      this.$emit('complete', result);
    },
    reset() {
      if (this.captchaInstance) {
        this.captchaInstance.reset();
      }
    }
  }
};
&lt;/script&gt;
            </div>
        </div>

        <div id="angular" class="framework-content">
            <h4>🅰️ Angular 컴포넌트</h4>
            <div class="code-block">
// real-captcha.component.ts
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild, AfterViewInit, OnDestroy } from '@angular/core';

declare global {
  interface Window {
    renderRealCaptcha: any;
  }
}

@Component({
  selector: 'app-real-captcha',
  template: `&lt;div #captchaContainer&gt;&lt;/div&gt;`
})
export class RealCaptchaComponent implements AfterViewInit, OnDestroy {
  @ViewChild('captchaContainer', { static: true }) captchaContainer!: ElementRef;
  @Input() theme: string = 'light';
  @Input() size: string = 'normal';
  @Output() complete = new EventEmitter&lt;any&gt;();
  
  private captchaInstance: any;

  ngAfterViewInit() {
    this.initCaptcha();
  }

  ngOnDestroy() {
    if (this.captchaInstance) {
      this.captchaInstance.destroy();
    }
  }

  private initCaptcha() {
    if (typeof window !== 'undefined' && window.renderRealCaptcha) {
      this.captchaInstance = window.renderRealCaptcha(
        this.captchaContainer.nativeElement,
        {
          theme: this.theme,
          size: this.size
        },
        (result: any) =&gt; this.complete.emit(result)
      );
    }
  }

  reset() {
    if (this.captchaInstance) {
      this.captchaInstance.reset();
    }
  }
}
            </div>
        </div>

        <div id="wordpress" class="framework-content">
            <h4>📝 WordPress 플러그인</h4>
            <div class="code-block">
// functions.php
function realcaptcha_enqueue_scripts() {
    wp_enqueue_script('react', 'https://unpkg.com/react@18/umd/react.production.min.js', array(), '18.0.0', true);
    wp_enqueue_script('react-dom', 'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js', array('react'), '18.0.0', true);
    wp_enqueue_script('realcaptcha', 'https://cdn.realcaptcha.com/latest/realcaptcha-widget.min.js', array('react', 'react-dom'), '1.0.0', true);
}
add_action('wp_enqueue_scripts', 'realcaptcha_enqueue_scripts');

// shortcode
function realcaptcha_shortcode($atts) {
    $atts = shortcode_atts(array(
        'theme' =&gt; 'light',
        'size' =&gt; 'normal',
        'id' =&gt; 'captcha-' . uniqid()
    ), $atts);
    
    $output = '&lt;div id="' . esc_attr($atts['id']) . '"&gt;&lt;/div&gt;';
    $output .= '&lt;script&gt;';
    $output .= 'document.addEventListener("DOMContentLoaded", function() {';
    $output .= 'renderRealCaptcha("' . esc_js($atts['id']) . '", {';
    $output .= 'theme: "' . esc_js($atts['theme']) . '",';
    $output .= 'size: "' . esc_js($atts['size']) . '"';
    $output .= '}, function(result) {';
    $output .= 'console.log("WordPress Captcha:", result);';
    $output .= '});';
    $output .= '});';
    $output .= '&lt;/script&gt;';
    
    return $output;
}
add_shortcode('realcaptcha', 'realcaptcha_shortcode');

// 사용법: [realcaptcha theme="dark" size="compact"]
            </div>
        </div>
    </div>

    <!-- React 및 ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Real Captcha Widget -->
    <script src="https://cdn.realcaptcha.com/latest/realcaptcha-widget.min.js"></script>
    
    <!-- 성능 모니터링 -->
    <script src="../monitoring/performance-monitor.js"></script>
    
    <script>
        // 전역 변수
        let captchaInstances = {};
        let performanceMonitor = null;
        
        // 기본 예제
        function initBasicCaptcha() {
            if (captchaInstances.basic) {
                captchaInstances.basic.destroy();
            }
            captchaInstances.basic = renderRealCaptcha('captcha-basic', {
                theme: 'light',
                size: 'normal'
            }, function(result) {
                showResult('result-basic', result, '기본 캐트차');
            });
        }
        
        function resetBasicCaptcha() {
            if (captchaInstances.basic) {
                captchaInstances.basic.reset();
                hideResult('result-basic');
            }
        }
        
        // 커스텀 옵션
        function initCustomCaptcha() {
            if (captchaInstances.custom) {
                captchaInstances.custom.destroy();
            }
            captchaInstances.custom = renderRealCaptcha('captcha-custom', {
                theme: 'dark',
                size: 'compact',
                language: 'ko'
            }, function(result) {
                showResult('result-custom', result, '커스텀 캐트차');
            });
        }
        
        function resetCustomCaptcha() {
            if (captchaInstances.custom) {
                captchaInstances.custom.reset();
                hideResult('result-custom');
            }
        }
        
        // 다중 인스턴스
        function initMultiCaptcha() {
            ['multi1', 'multi2'].forEach(id => {
                if (captchaInstances[id]) {
                    captchaInstances[id].destroy();
                }
                captchaInstances[id] = renderRealCaptcha(`captcha-${id}`, {
                    theme: id === 'multi1' ? 'light' : 'dark',
                    size: 'normal'
                }, function(result) {
                    showResult('result-multi', result, `다중 캐트차 ${id}`);
                });
            });
        }
        
        function resetMultiCaptcha() {
            ['multi1', 'multi2'].forEach(id => {
                if (captchaInstances[id]) {
                    captchaInstances[id].reset();
                }
            });
            hideResult('result-multi');
        }
        
        // 동적 로딩
        function loadDynamicCaptcha() {
            if (captchaInstances.dynamic) {
                captchaInstances.dynamic.destroy();
            }
            captchaInstances.dynamic = renderRealCaptcha('captcha-dynamic', {
                theme: 'light',
                size: 'normal'
            }, function(result) {
                showResult('result-dynamic', result, '동적 캐트차');
            });
        }
        
        function unloadDynamicCaptcha() {
            if (captchaInstances.dynamic) {
                captchaInstances.dynamic.destroy();
                captchaInstances.dynamic = null;
                document.getElementById('captcha-dynamic').innerHTML = '<p>캐트차가 제거되었습니다.</p>';
                hideResult('result-dynamic');
            }
        }
        
        // 폼 통합
        function initFormCaptcha() {
            if (captchaInstances.form) {
                captchaInstances.form.destroy();
            }
            captchaInstances.form = renderRealCaptcha('captcha-form', {
                theme: 'light',
                size: 'normal'
            }, function(result) {
                window.captchaResult = result;
                showResult('result-form', result, '폼 캐트차');
            });
        }
        
        function handleLogin(event) {
            event.preventDefault();
            
            if (!window.captchaResult || !window.captchaResult.success) {
                alert('캐트차를 먼저 완료해주세요.');
                return false;
            }
            
            // 실제 로그인 처리
            alert('로그인 성공! (데모)');
            return false;
        }
        
        // 성능 모니터링
        function startPerformanceTest() {
            if (performanceMonitor) {
                performanceMonitor.stop();
            }
            
            performanceMonitor = new CDNPerformanceMonitor({
                cdnUrls: ['https://cdn.realcaptcha.com/latest/realcaptcha-widget.min.js'],
                interval: 5000 // 5초마다
            });
            
            performanceMonitor.start();
            
            // 결과 업데이트
            const updatePerformance = async () => {
                try {
                    const startTime = performance.now();
                    const response = await fetch('https://cdn.realcaptcha.com/latest/realcaptcha-widget.min.js', {
                        method: 'HEAD',
                        cache: 'no-cache'
                    });
                    const endTime = performance.now();
                    
                    document.getElementById('load-time').textContent = (endTime - startTime).toFixed(2);
                    document.getElementById('cache-status').textContent = response.headers.get('x-cache') || '알 수 없음';
                    document.getElementById('file-size').textContent = formatBytes(response.headers.get('content-length') || 0);
                } catch (error) {
                    console.error('성능 테스트 오류:', error);
                }
            };
            
            updatePerformance();
            window.performanceInterval = setInterval(updatePerformance, 5000);
        }
        
        function stopPerformanceTest() {
            if (performanceMonitor) {
                performanceMonitor.stop();
                performanceMonitor = null;
            }
            
            if (window.performanceInterval) {
                clearInterval(window.performanceInterval);
            }
        }
        
        // 헬퍼 함수
        function showResult(elementId, result, source) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result ' + (result.success ? 'success' : 'error');
            element.innerHTML = `
                <strong>${source} 결과:</strong><br>
                상태: ${result.success ? '성공' : '실패'}<br>
                ${result.token ? `토큰: ${result.token.substring(0, 20)}...` : ''}<br>
                시간: ${new Date().toLocaleTimeString()}
            `;
        }
        
        function hideResult(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function showFramework(framework) {
            // 모든 탭 비활성화
            document.querySelectorAll('.framework-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.framework-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 선택된 탭 활성화
            document.querySelector(`[onclick="showFramework('${framework}')"]`).classList.add('active');
            document.getElementById(framework).classList.add('active');
        }
        
        // 초기 로드
        document.addEventListener('DOMContentLoaded', function() {
            initBasicCaptcha();
            initCustomCaptcha();
            initMultiCaptcha();
            initFormCaptcha();
        });
    </script>
</body>
</html>